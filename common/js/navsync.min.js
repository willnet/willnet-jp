/*
 *  navsync - v0.1.0
 *  Sync navigation menus to page anchors
 *  https://github.com/rp4rk/navsync
 *
 *  Made by Ryan Park
 *  Under MIT License
 */
!function(a,b){"use strict";function c(b,c){this.element=b,this.settings=a.extend({},e,c),this._defaults=e,this._name=d,this.init()}var d="navSync",e={highlightClass:"navsync-menu-highlight",ignoreNavHeightScroll:!1,animationTime:500};a.extend(c.prototype,{init:function(){var c=a(this.element);this.highlightClass=this.settings.highlightClass?this.settings.highlightClass:this._defaults.highlightClass,this.initHeaderHeight(c),a(b).resize(function(){this.initHeaderHeight(c),this.watchedDivs=this.buildWatchedDivs(c),this.checkForHighlight(this.watchedDivs),this.watchedDivs.forEach(function(a){a[3].unbind("click")}),this.initClickBinding()}.bind(this)),this.watchedDivs=this.buildWatchedDivs(c),this.initClickBinding(),this.checkForHighlight(this.watchedDivs),a(b).bind("scroll",function(){this.scrollFunc()}.bind(this))},initHeaderHeight:function(a){this.headerHeight=this.settings.ignoreNavHeightScroll?0:a.height()},scrollFunc:function(){b.requestAnimationFrame(function(){this.checkForHighlight(this.watchedDivs)}.bind(this))},checkForHighlight:function(a){a.forEach(function(a){this.isInView(a[1],a[2])?a[3].addClass(this.highlightClass):a[3].removeClass(this.highlightClass)}.bind(this))},getAnchors:function(b){var c=[];return b.find("a").each(function(b,d){c.push(a(d))}),c},buildWatchedDivs:function(b){var c=this.getAnchors(b).filter(function(a){return this.isAnchor(a)}.bind(this)).map(function(b){var c=a(b.attr("href").replace("/",""));return[c,c.offset().top,c.offset().top+c.outerHeight(!0),b]}.bind(this));return c},isInView:function(c,d){var e=a(b).scrollTop()+a(b).height()/2;return e>=c&&d>=e},isAnchor:function(a){var b=a.attr("href").replace("/","");return"#"===b.charAt(0)},scrollTo:function(c,d,e){a("html, body").animate({scrollTop:c-e},d,function(){a(b).bind("scroll",function(){this.scrollFunc()}.bind(this)),this.checkForHighlight(this.watchedDivs)}.bind(this))},initClickBinding:function(){this.watchedDivs.forEach(function(c){c[3].click(function(d){a(b).unbind("scroll"),d.preventDefault(),this.scrollTo(c[1],500,this.headerHeight)}.bind(this))}.bind(this))}}),a.fn[d]=function(b){return this.each(function(){a.data(this,"plugin_"+d)||a.data(this,"plugin_"+d,new c(this,b))})}}(jQuery,window,document);